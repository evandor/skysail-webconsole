{"version":3,"sources":["app/directives/d3serviceDep.directive.ts"],"names":[],"mappings":"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","file":"d3serviceDep.directive.js","sourcesContent":["import {Component, Directive, ElementRef, Input, OnInit} from '@angular/core'\n\nimport {BackendServices} from '../services/backend.service';\nimport {Node} from '../domain/node';\nimport {Edge} from '../domain/edge';\n\nimport * as d3 from 'd3';\n\n\n@Directive({\n    selector: \"[d3serviceDep]\"\n})\nexport class D3ServiceDepDirective {\n\n    rNodes = Array<Node>(); // requirererNodes\n    pNodes = Array<Node>(); // providerNodes\n\n    constructor(private _el: ElementRef, private _backend: BackendServices) { }\n\n    ngOnInit() {\n        this._backend.getLatestSnapshot().subscribe(res => {\n            \n            var identifier = \"#d3serviceDep\";\n\n            var nodes = Array<Node>();\n            var edges = Array<Edge>();\n            var toCounter = new Map<string, number>();\n\n            var filteredBundles = res.bundles.filter(function(el) {\n                //console.log(el.id);\n                return el;//el.id == 0 ? null : el;\n            });\n\n\n            filteredBundles.forEach(bundle => {\n                //console.log(\"creating new Node with id \" + bundle.id);\n                nodes.push(new Node(bundle.id, bundle.symbolicName, 17, 500));\n                bundle.usedServiceIds.forEach(serviceId => {\n                    var providingBundle = getProvidingBundle(serviceId);\n                    //console.log(bundle.id + \" => \" + serviceId + \" => \" + providingBundle);\n                    edges.push(new Edge(bundle.id, providingBundle, 1));\n                });\n            });\n\n            function getProvidingBundle(serviceId: string) {\n                var result = null;\n                res.services.forEach(service => {\n                    if (service.id == serviceId) {\n                        result = service.bundleId;\n                    }\n                });\n                return result;\n            }\n\n            var nodeHash = {};\n            for (let x in nodes) {\n                nodeHash[nodes[x].id] = nodes[x];\n            };\n            //console.log(nodeHash);\n            for (let x in edges) {\n                edges[x].weight = 1;//parseInt(edges[x].weight);\n                edges[x].source = nodeHash[edges[x].source];\n                edges[x].target = nodeHash[edges[x].target];\n            };\n            //console.log(edges);\n\n            var weightScale = d3.scale.linear()\n                .domain(d3.extent(edges, function (d) { return d.weight; }))\n                .range([.3, 5]);\n\n            var force = d3.layout.force().charge(-2000)\n                .size([1000, 600])\n                .nodes(nodes)\n                .links(edges)\n                .on(\"tick\", forceTick);\n\n            d3.select(identifier).selectAll(\"line.link\")\n                .data(edges, function (d) { return d.source.id + \"-\" + d.target.id; })\n                .enter()\n                .append(\"line\")\n                .attr(\"class\", \"link\")\n                .style(\"stroke\", \"black\")\n                .style(\"opacity\", .5)\n                .style(\"stroke-width\", function (d) { return weightScale(d.weight) });\n\n            var nodeEnter = d3.select(identifier).selectAll(\"g.node\")\n                .data(nodes, function (d) { return d.id })\n                .enter()\n                .append(\"g\")\n                .attr(\"class\", \"node\");\n\n            nodeEnter.append(\"circle\")\n                .attr(\"r\", function (d) { return 4; })\n                .style(\"fill\", \"lightgray\")\n                .style(\"stroke\", \"black\")\n                .style(\"stroke-width\", \"1px\");\n\n            nodeEnter.append(\"text\")\n                .style(\"text-anchor\", \"middle\")\n                .attr(\"x\", 18)\n                .attr(\"y\", 18)\n                .text(function (d) { return d.id; });\n\n            force.start();\n\n            var marker = d3.select(identifier).append('defs')\n                .append('marker')\n                .attr(\"id\", \"Triangle\")\n                .attr(\"refX\", 12)\n                .attr(\"refY\", 6)\n                .attr(\"markerUnits\", 'userSpaceOnUse')\n                .attr(\"markerWidth\", 12)\n                .attr(\"markerHeight\", 18)\n                .attr(\"orient\", 'auto')\n                .append('path')\n                .attr(\"d\", 'M 0 0 12 6 0 12 3 6');\n            d3.selectAll(\"line\").attr(\"marker-end\", \"url(#Triangle)\");\n            \n            function forceTick() {\n                d3.selectAll(\"line.link\")\n                    .attr(\"x1\", function (d) { return d.source.x; })\n                    .attr(\"x2\", function (d) { return d.target.x; })\n                    .attr(\"y1\", function (d) { return d.source.y; })\n                    .attr(\"y2\", function (d) { return d.target.y; });\n\n                d3.selectAll(\"g.node\")\n                    .attr(\"transform\", function (d) {\n                        return \"translate(\" + d.x + \",\" + d.y + \")\";\n                    })\n            }\n        });\n    }\n\n\n}"]}