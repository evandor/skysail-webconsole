{"version":3,"sources":["app/directives/d3pkgDep.directive.ts"],"names":[],"mappings":"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","file":"app/directives/d3pkgDep.directive.js","sourcesContent":["import {Component, Directive, ElementRef, Input, OnInit} from '@angular/core'\r\n\r\nimport {BackendServices} from '../services/backend.service';\r\nimport {Node} from '../domain/node';\r\nimport {Edge} from '../domain/edge';\r\n\r\nimport * as d3 from 'd3';\r\n\r\n\r\n@Directive({\r\n    selector: \"[d3PkgDep]\"\r\n})\r\nexport class D3PkgDepDirective {\r\n\r\n    rNodes = Array<Node>(); // requirererNodes\r\n    pNodes = Array<Node>(); // providerNodes\r\n\r\n    constructor(private _el: ElementRef, private _backend: BackendServices) { }\r\n\r\n    ngOnInit() {\r\n        this._backend.getLatestSnapshot().subscribe(res => {\r\n            var identifier = \"#d3PkgDep\";\r\n            var nodes = Array<Node>();\r\n            var edges = Array<Edge>();\r\n            var toCounter = new Map<string, number>();\r\n\r\n            /* var filteredBundles = res.bundles.filter(function (el) {\r\n                 //console.log(el.id);\r\n                 return el.id == 0 ? null : el;\r\n             });*/\r\n\r\n\r\n            //filteredBundles\r\n            res.bundles.forEach(bundle => {\r\n                //console.log(\"creating new Node with id \" + bundle.id);\r\n                nodes.push(new Node(bundle.id, bundle.symbolicName, 17, 500));\r\n                //console.log(bundle.wireDescriptor.providedWires);\r\n                var arr = Object.keys(bundle.wireDescriptor.providedWires).map(function (key) {\r\n                    return {\r\n                        key: key,\r\n                        value: bundle.wireDescriptor.providedWires[key]\r\n                    }\r\n                });\r\n                arr.forEach(wire => {\r\n                    //console.log(wire);\r\n                    edges.push(new Edge(bundle.id, wire.key, wire.value));\r\n                });\r\n            });\r\n\r\n            var nodeHash = {};\r\n            for (let x in nodes) {\r\n                nodeHash[nodes[x].id] = nodes[x];\r\n            };\r\n            //console.log(nodeHash);\r\n            for (let x in edges) {\r\n                edges[x].weight = parseInt(edges[x].weight);\r\n                edges[x].source = nodeHash[edges[x].source];\r\n                edges[x].target = nodeHash[edges[x].target];\r\n            };\r\n            //console.log(edges);\r\n\r\n            var weightScale = d3.scale.linear()\r\n                .domain(d3.extent(edges, function (d) { return d.weight; }))\r\n                .range([.3, 5]);\r\n\r\n            var force = d3.layout.force().charge(-2000)\r\n                .size([1000, 600])\r\n                .nodes(nodes)\r\n                .links(edges)\r\n                .on(\"tick\", forceTick);\r\n\r\n            d3.select(identifier).selectAll(\"line.link\")\r\n                .data(edges, function (d) { return d.source.id + \"-\" + d.target.id; })\r\n                .enter()\r\n                .append(\"line\")\r\n                .attr(\"class\", \"link\")\r\n                .style(\"stroke\", \"black\")\r\n                .style(\"opacity\", .5)\r\n                .style(\"stroke-width\", function (d) { return weightScale(d.weight) });\r\n\r\n            var nodeEnter = d3.select(identifier).selectAll(\"g.node\")\r\n                .data(nodes, function (d) { return d.id })\r\n                .enter()\r\n                .append(\"g\")\r\n                .attr(\"class\", \"node\");\r\n\r\n            nodeEnter.append(\"circle\")\r\n                .attr(\"r\", function (d) { return 4; })\r\n                .style(\"fill\", \"lightgray\")\r\n                .style(\"stroke\", \"black\")\r\n                .style(\"stroke-width\", \"1px\");\r\n\r\n            nodeEnter.append(\"text\")\r\n                .style(\"text-anchor\", \"middle\")\r\n                .attr(\"x\", 18)\r\n                .attr(\"y\", 18)\r\n                .text(function (d) { return d.id; });\r\n\r\n            force.start();\r\n\r\n            var marker = d3.select(identifier).append('defs')\r\n                .append('marker')\r\n                .attr(\"id\", \"Triangle1\")\r\n                .attr(\"refX\", 12)\r\n                .attr(\"refY\", 6)\r\n                .attr(\"markerUnits\", 'userSpaceOnUse')\r\n                .attr(\"markerWidth\", 12)\r\n                .attr(\"markerHeight\", 18)\r\n                .attr(\"orient\", 'auto')\r\n                .append('path')\r\n                .attr(\"d\", 'M 0 0 12 6 0 12 3 6');\r\n\r\n            d3.selectAll(\"line\").attr(\"marker-end\", \"url(#Triangle1)\");\r\n\r\n            function forceTick() {\r\n                d3.selectAll(\"line.link\")\r\n                    .attr(\"x1\", function (d) { return d.source.x; })\r\n                    .attr(\"x2\", function (d) { return d.target.x; })\r\n                    .attr(\"y1\", function (d) { return d.source.y; })\r\n                    .attr(\"y2\", function (d) { return d.target.y; });\r\n\r\n                d3.selectAll(\"g.node\")\r\n                    .attr(\"transform\", function (d) {\r\n                        return \"translate(\" + d.x + \",\" + d.y + \")\";\r\n                    })\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n}"],"sourceRoot":"/source/"}