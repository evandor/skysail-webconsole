{"version":3,"sources":["app/directives/d3pkgDep.directive.ts"],"names":[],"mappings":"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","file":"app/directives/d3pkgDep.directive.js","sourcesContent":["import {Component, Directive, ElementRef, Input, OnInit} from '@angular/core'\n\nimport {BackendServices} from '../services/backend.service';\nimport {Node} from '../domain/node';\nimport {Edge} from '../domain/edge';\n\nimport * as d3 from 'd3';\n\n\n@Directive({\n    selector: \"[d3PkgDep]\"\n})\nexport class D3PkgDepDirective {\n\n    rNodes = Array<Node>(); // requirererNodes\n    pNodes = Array<Node>(); // providerNodes\n\n    constructor(private _el: ElementRef, private _backend: BackendServices) { }\n\n    ngOnInit() {\n        var url = \"http://localhost:2002/backend/v1/snapshotdetails/latest\"\n        d3.json(url, function (error, data) {\n            if (error != null) {\n                console.log(error);\n            }\n\n            var nodes = Array<Node>();\n            var edges = Array<Edge>();\n            var toCounter = new Map<string, number>();\n\n\n            data.bundles.forEach(bundle => {\n                //console.log(\"creating new Node with id \" + bundle.id);\n                nodes.push(new Node(bundle.id, bundle.symbolicName, 17, 500));\n                bundle.wireDescriptor.providedWires.forEach(wire => {\n                    var requirerId = wire.rid;\n                    if (toCounter.has(requirerId)) {\n                        var old = toCounter.get(requirerId);\n                        toCounter.set(requirerId, old + 1);\n                    } else {\n                        toCounter.set(requirerId, 1);\n                    }\n                    toCounter.forEach((value, index, map) => {\n                        if (index != \"0\") {\n                            //console.log(bundle.id + \": \" + index + \"/\" + value);\n                           edges.push(new Edge(bundle.id, index, value));\n                        }\n                    });\n                });\n            });\n\n            var nodeHash = {};\n            for (let x in nodes) {\n                nodeHash[nodes[x].id] = nodes[x];\n            };\n            //console.log(nodeHash);\n            for (let x in edges) {\n                edges[x].weight = parseInt(edges[x].weight);\n                edges[x].source = nodeHash[edges[x].source];\n                edges[x].target = nodeHash[edges[x].target];\n            };\n            //console.log(edges);\n\n            var weightScale = d3.scale.linear()\n                .domain(d3.extent(edges, function (d) { return d.weight; }))\n                .range([.1, 1]);\n            console.log(weightScale);\n\n            var force = d3.layout.force().charge(-1000)\n                .size([500, 500])\n                .nodes(nodes)\n                .links(edges)\n                .on(\"tick\", forceTick);\n\n\n            d3.select(\"#d3PkgDep\").selectAll(\"line.link\")\n                .data(edges, function (d) { return d.source.id + \"-\" + d.target.id; })\n                .enter()\n                .append(\"line\")\n                .attr(\"class\", \"link\")\n                .style(\"stroke\", \"black\")\n                .style(\"opacity\", .5)\n                .style(\"stroke-width\", function (d) { return d.weight });\n\n            var nodeEnter = d3.select(\"#d3PkgDep\").selectAll(\"g.node\")\n                .data(nodes, function (d) { return d.id })\n                .enter()\n                .append(\"g\")\n                .attr(\"class\", \"node\");\n\n            nodeEnter.append(\"circle\")\n                .attr(\"r\", 5)\n                .style(\"fill\", \"lightgray\")\n                .style(\"stroke\", \"black\")\n                .style(\"stroke-width\", \"1px\");\n            \n            nodeEnter.append(\"text\")\n                .style(\"text-anchor\", \"middle\")\n                .attr(\"y\", 15)\n                .text(function (d) { return d.id; });\n            \n            force.start();\n            /*var graph = d3.select(\"#d3PkgDep\")\n                .selectAll(\"g\")\n                .data(data.bundles)\n                .enter()\n                .append(\"g\")\n                .attr(\"transform\", function (d, i) {\n                    var y = 20 + i * 20;\n                    return \"translate(100,\" + y + \")\";\n                })\n                .style(\"fill\", function (d) { return \"white\"; })\n                .style(\"stroke\", \"black\")\n                .style(\"stroke-width\", \"1px\")\n                .attr(\"y\", function (d, i) { return i * 20 });\n\n            graph\n                .append(\"text\")\n                .text(function (d) { return d.symbolicName; });\n\n            graph\n                .append(\"rect\")\n                .attr(\"width\", 200)\n                .attr(\"height\", 18)\n                .transition(\"translate(0,-18)\")\n                ;*/\n\n            function forceTick() {\n                d3.selectAll(\"line.link\")\n                    .attr(\"x1\", function (d) { return d.source.x; })\n                    .attr(\"x2\", function (d) { return d.target.x; })\n                    .attr(\"y1\", function (d) { return d.source.y; })\n                    .attr(\"y2\", function (d) { return d.target.y; });\n\n                d3.selectAll(\"g.node\")\n                    .attr(\"transform\", function (d) {\n                        return \"translate(\" + d.x + \",\" + d.y + \")\";\n                    })\n            }\n        });\n    }\n\n\n}"],"sourceRoot":"/source/"}